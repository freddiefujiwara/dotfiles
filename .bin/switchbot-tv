#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
. "$SCRIPT_DIR/switchbot-common"

usage() {
  echo "Usage: $0 -d <deviceid> -c <channel>" >&2
}

deviceid=""
channel=""
while getopts d:c: option; do
  case "${option}" in
    d) deviceid=${OPTARG} ;;
    c) channel=${OPTARG} ;;
    *) usage; exit 1 ;;
  esac
done

if [[ -z $deviceid || -z $channel ]]; then
  usage
  exit 1
fi

command="$(printf '{"command": "SetChannel","parameter": "%s","commandType": "command"}' "$channel")"

switchbot_post "/devices/${deviceid}/commands" "${command}" | jq
